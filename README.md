# 가상 데이터를 활용한 자율주행 모델 성능 향상
#자율주행 #인공지능 # 가상 데이터 # 가상 공간 # 3D유니티 #PPO알고리즘 <br/>
#✏이형원교수님 김경이교수님 감사합니다.✏

## 📜 프로젝트 소개 
 - 실제 자율주행 모델을 학습시킬때 가상 데이터가 좋은 영향을 주는지 확인해보기 위해 실제 공간과 가상 공간을 만들어 실험을 진행하였습니다
 - 기존 pilot_net논문에서는 도로의 모양을 보고 조향각도를 예측했다면 저는 차량 정면 이미지를 다 보고 신호등과 도로 상태를 보고 조향각도와 악셀의 사용 유무를 예측 할 수 있도록 제작하였습니다.
 - 가상 공간은 제가 만든 Automatic-Data-Collecter를 가지고 진행하였습니다.

## ⌚ 개발 기간
* 2023.05 ~2023.12

## 🛠 개발 환경
- python
- pytorch
- C#     
- Unity


# 🎥지금부터 설명을 시작하겠습니다.

![슬라이드1](https://github.com/gkxotjd12312/Thesis/assets/54784059/79a33249-f479-417c-b341-224cf1fda974)

![슬라이드2](https://github.com/gkxotjd12312/Thesis/assets/54784059/1762118c-ff6d-4530-a43e-aa15d410ddd4)

![슬라이드3](https://github.com/gkxotjd12312/Thesis/assets/54784059/05991d46-476e-4aaa-8fdc-6ba5a3e955d7)

![슬라이드4](https://github.com/gkxotjd12312/Thesis/assets/54784059/c39ad1cc-ace3-436f-be3b-d73c66eb6c64)
 - 인공지능의 모델 성능은 데이터와 많은 관련이 있습니다. 
 - 그래서 데이터 부족 같은 상황이 발생하면 좌측그림과 같이 이미지를 회전시키거나 색을 조절하는 데이터 증강방법들을 사용되곤 합니다.
 - 하지만 이렇게 한다고 해서 데이터 부족 문제를 완벽하게 해결하지는 못합니다.
 - 이를 보안하고자 최근에는 우측처럼 가상데이터에 대해 많은 연구가 이루어지고 있습니다.
 - 그래서 저의 논문에서는 이러한 가상 데이터가 실제로 좋은 성능을 내는지 확인하고자 실험을 진행하였습니다.

![슬라이드5](https://github.com/gkxotjd12312/Thesis/assets/54784059/330b20c6-8ea1-4dfe-b715-fd9802677c1c)
 - 우선 가상 데이터에 대한 여러 가지 연구 결과들이 있는데요.
 - 첫 번째로 VKITTI데이터셋이 있습니다. 이 데이터셋은 좌측에 보이는 실제 공간에서 수집한 데이터인 KITTI데이터셋을 우측의 이미지처럼 가상공간에 그대로 반영한 뒤에 날씨나 빛의 세기, 차량 같은 객체에 변화를 주어 데이터를 수집을 한 VKITTI데이터셋입니다. 이러한 가상 데이터를 같이 사용한 결과 1~5%의 성능 향상을 보여주었습니다.
 - 두 번째로 Domain Randomization이 있습니다. 줄여서 DP는 그림에서처럼 완전히 이질적인 공간에 객체를 생성하여 데이터를 수집하는 방식을 사용하였고, 이렇게 이질적인 데이터를 사용했음에도 3가지 모델중에 2가지 모델에서 VKITTI데이터셋 보다 7%에서 10%정도의 성능향상을 보여주었습니다.
 - 마지막으로 Sim데이터셋입니다. 이번 데이터셋은 GTA게임 환경에서 데이터를 수집하는 방식을 사용하였는데요. 실험에 사용된 학습 데이터는 실제 데이터셋인 cityscapes데이터셋보다 10배부터 20배나 많은 데이터를 수집할수있었는데요. 이렇게 수집한 데이터로 학습한 결과 5만장 학습때 부터 실제 데이터보다 6%~7%정도 성능향상을 보여주었습니다. 이렇게 까지 좋은 성능을 보여줄 수 있었던 것은 논문에서는 컴퓨터 그래픽의 성능 향상과 많은 양의 데이터가 영향을 주었다고 합니다.

![슬라이드6](https://github.com/gkxotjd12312/Thesis/assets/54784059/3e9551a3-1a39-4283-9cb1-e09f5ea8e594)
 - 다음은 자율 주행에 대한 선행 연구를 간단하게 하나만 보고 넘어가도록 하겠습니다.
 - 전통적으로 자율주행에 인공지능은 Object Detection로 차량 주변의 객체를 확인하고 차량 제어는 알고리즘으로 제어하는것이 사고확률도 낮고 일반적입니다.
 - 하지만 엔비디아의 Pilot_Net논문에서 인공지능을 활용한 End To ENd방식의 자율주행을 보여주었고 조향각도만 해결하면 되는 도로 16킬로미터를 98% 주행에 성공하였습니다.
 - 그래서 저의 논문은 End-To-End방식의 자율주행을 만들고 가상공간 데이터로 모델의 성능을 얼마나 효과적으로 향상시킬 수 있을지 연구하였습니다. 기존의 pilot_net논문에서는 도로의 모양을 보고 조향각도를 예측했다면 저는 차량 정면 이미지를 다 보고 신호등 까지 보고 조향각도와 악셀의 사용 유무를 예측 할 수 있도록 제작하였습니다.

![슬라이드7](https://github.com/gkxotjd12312/Thesis/assets/54784059/7e637df6-1dcf-4e3c-a19b-012c651d5f82)
 - 실험에 필요한 차량은 좌측에 보이는 것처럼 1/10RC카와 jetson xavier NX을 사용하여 실험용 차량을 제작하였습니다.
 - 환경은 차량에 맞게 임의로 제작하였고, 신호등도 따로 제작하여 환경을 제작하였습니다.

![슬라이드8](https://github.com/gkxotjd12312/Thesis/assets/54784059/b528499a-6546-4005-8588-1f06557d3d70)
 - 차량에서 수집하는 데이터는 보이는데로 정면 이미지와 그때 차량의 악셀 사용 유무(speed)와 조향각도(angle)를 csv파일로 만들어 사용하였습니다.

![슬라이드9](https://github.com/gkxotjd12312/Thesis/assets/54784059/4ffc1514-bbfb-4b9e-8b8f-b5bfdbe73b4d)
 - 이번에는 가상공간입니다.
 - 가상공간은 제가 만든 ADC를 가지고 수정한 뒤에 사용하였습니다.
 - 보시면 실제 환경의 특징을 잘 표현한것을 확인할 수 있습니다.

![슬라이드10](https://github.com/gkxotjd12312/Thesis/assets/54784059/70e5d4f6-8628-4852-94a1-e589bc06a211)
 - ADC는 환경을 계속 랜덤하게 만들어 다양한 데이터를 수집할 수 있었고
 - 가상공간 전용 자율 주행 모델을 통해 사용자 없이도 많은 데이터를 수집할 수 있었습니다.

![슬라이드11](https://github.com/gkxotjd12312/Thesis/assets/54784059/ff03cc63-a8da-427d-bc94-f030d4452485)
 - ADC의 전용 자율 주행 모델에 대해 조금만 더 설명하도록 하겠습니다.
 - 전용 자율 주행 모델은 차량에 Lidar센서로 주변을 감지하고 다양한 환경을 강화 학습 PPO알고리즘으로 제작된 모델입니다.
 - 지금 보이시는 보상체계 뿐만 아니라 다양한 보상과 학습 방법을 통해 지금까지 사고없이 데이터를 수집할 수 있었습니다.

![슬라이드12](https://github.com/gkxotjd12312/Thesis/assets/54784059/ed95e541-5450-4c16-b355-c0a059b9b501)
 - ADC를 보시는 다른 분들이 이렇게 질문을 많이 하셨는데요. 
(ADC에서 정면이미지와 PPO알고리즘으로 자율 주행 모델을 만들어서 바로 실제 공간에 넣어도 되는것 아니냐?)
 - 나중에 실험 결과에서 보여드릴건데 미리 보여드리자면 가상 공간 데이터로만 학습한 모델은 실제 공간에서 낮은 성능을 보이기 때문에 이 방법은 사용하지 않았습니다.
 - 다음은 총 3가지 실험과 결과를 보여드리도록 하겠습니다.

![슬라이드13](https://github.com/gkxotjd12312/Thesis/assets/54784059/cc6815e3-0bc2-4595-a79b-4d539acf800f)
 - 첫 번째 실험은 차량의 정면 이미지와 조향각도만 예측하는 모델 3가지를 가지고 실제 데이터, 합성 데이터의 성능 비교를 진행하였습니다.
 - 참고로 주의 깊게 보셔야하는 점은 우측의 그림처럼 speed는 제외하고 angle(조향각도)만 예측하도록 모델을 수정한것입니다. 

![슬라이드14](https://github.com/gkxotjd12312/Thesis/assets/54784059/f4997c2b-3764-4a2d-b45b-803214977090)
 - 실험 결과 총 3가지 모델에서 총 2가지 모델에서 합성 데이터를 사용했을때 5%~30%성능 향상을 보인것을 확인하였습니다.
 - 또한 저의 실험에서는 Pilot_net모델보다 vgg16이 제일 성적을 보여주었습니다.
 - 하지만 실제 jetson에서 vgg16을 가지고 20FPS가 나오지 않아 성능이 비슷한 Mobile_Net_v2를 가지고 실제 데이터, 가상 데이터, 합성 데이터의 성능을 비교하는 실험을 진행하였습니다.

![슬라이드15](https://github.com/gkxotjd12312/Thesis/assets/54784059/7c731148-5647-4f8e-992f-1142287eb199)
 - 두 번째 실험은 모바일넷v2를 가지고 실제 데이터, 가상 데이터, 혼합 데이터별로 자율 주행성능이 어떻게 나오는지 실험해보았습니다.
 - 참고로 주의 깊게 보셔야하는 점은 첫 번째 실험과는 다르게 정면 이미지를 보고 조향각도(angle)뿐만 아니라 악셀(spped)예측 까지 진행하였습니다.

![슬라이드16](https://github.com/gkxotjd12312/Thesis/assets/54784059/33e51d05-c18a-4ee7-ae07-336dac7fa90b)
 - 실험 결과 첫 번째 실험 만큼은 아니지만 합성 데이터가 실제 데이터만 학습 했을때 보다 약 1% 성능향상을 보여주었습니다.

![슬라이드17](https://github.com/gkxotjd12312/Thesis/assets/54784059/6be49117-c01f-4b11-aed5-66e6cb0ef67e)
 - 다음은 두번 째 실험에서 제작된 자율 주행 모델을 가지고 실제로 주행 테스트를 진행하였습니다.
 - 실제 주행 테스트는 임의로 제작한 기준표로 진행하였습니다.

![슬라이드18](https://github.com/gkxotjd12312/Thesis/assets/54784059/8476256d-3065-4ede-befe-da395b87a960)
 - 실험 결과 실제 데이터로만 학습한 모델과 합성 데이터로 학습한 모델 두 모델의 성능 차이는 딱히 향상된 모습을 보이지 못하였습니다.

![슬라이드19](https://github.com/gkxotjd12312/Thesis/assets/54784059/05f6ebfe-c855-4c34-9c23-7b5eb3b04a55)
 - 실험을 통해 가상 데이터는 수치적으로 봤을때는 매우 긍정적으로 보입니다.(1%~30%성능향상) 하지만 자율주행처럼 높은 정확도를 요구하는 모델같은 경우 현실 환경의 특성과 조건을 최대한 반영해서 가상공간을 제작하고, 더 많은 LOSS를 줄여야 좋은 성능을 보일것이라 예상됩니다.
